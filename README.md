# StockTrade
## 0. このレポジトリについて
このレポジトリは、株に関する下記のような操作をバッチ処理にて自動で行うためのレポジトリである。
1. 株価分析
2. 株の自動売買

### 0-1. 株価分析
* 株価に対して、下記の分析をバッチ処理にて行い、自動での株取引を行う
    1. ファンダメンタル分析<br>
        企業の業績評価を行い、優良株と判断される企業をピックアップする
    2. テクニカル分析<br>
        企業の株価チャートを分析し、優良株の「買い時」を見極める
* 手法としては、下記の方法を用いて企業の業績の情報を取得し、DBに保存して分析を行う
    * 株コムのAPIを実行
    * オンライン四季報をスクレイピング<br>
        ※スクレイピングにおける規約など要確認

### 0-2. 株の自動売買
* 株価分析の結果、取引をすべき株に関して、下記のような処理を行う
    1. 取引余力の確認
    2. 売買用のAPIの実行（株コムにてAPIが提供されている）

## 1. 設計方針
* 大規模な開発になることが予想されるため、処理単位でプログラムのファイルを分割しながら開発を行う。
* JavaなどのWebアプリであればMVCを参考にしながら分割するが、Pythonのためフォルダ名などの命名規則のベストプラクティスは調査中である。
### 1-1. bin/
* 要するにコントローラー。mainから呼び出される。
### 1-2. lib/
* 要するにロジック。binから呼び出される。
### 1-3. sql/
* DBとの接続で必要なもの。DAOやDTOに相当。
* バッチなのでSQLインジェクションの危険性はないが、念の為、生クエリを書かずにORMを用いる
### 1-4. その他必要なモジュール
* バッチで共通に用いるモジュールを定義<br>
尚、`utils`というディレクトリに格納したほうが見た目はすっきりするが、これはアンチパターンのため`main`と同じ改装に格納する<br>
※ `utils`というディレクトリを作ると、何でも`utils`の中に入れられ、設計が崩壊する
#### 1-4-1. batch_config.py
* バッチ全体にかかわる設定を定義する
* `conf/`内にyamlで環境別に設定ファイルを定義し、その内容を読み込む
* この設定インスタンスはDependency Injection(DI)を行い、各クラスでインスタンス化することの無いように設計する
#### 1-4-2. exception.py
* 例外処理用のミドルウェア
* エラーログの生成、通知処理を行う
#### 1-4-3. notification.py
* 通知処理を行う
* メール通知でも良いが、LINEへの通知をまずは行う予定

## 99. ToDo
### 99-01. 設計面のToDo
* Dependency Injection(DI)を用いた設計の見直し
* Exceptionをミドルウェアとして共通で例外処理を行うように設定
* DB接続用のモジュールの開発
### 99-02. 機能拡張面のToDo
* バッチのコンテナ化
  * `Dockerfile`を作成し、`python`のベースイメージをpullして本バッチをデプロイし、イメージをビルドする
  * requirements.txtを作成し、Dockerfileから`pip install`するように開発
* バッチログの分析
  * 取引ログを後から分析できるようにする<br>
    そのために必要なのは下記の2点
    1. ログをjsonにて出力
    2. 分析用のサービスと連携する（以下は例）
       * `mongoDB`にログを出力し、`Splunk`にて分析(Splunkは有償の為、注意)
       * `ElasticSearch`にログを出力し、分析
### 99-03. その他ToDo
* スクレイピングの法的準拠について
  * オンライン四季報のスクレイピングが法的に問題ないか規約の確認